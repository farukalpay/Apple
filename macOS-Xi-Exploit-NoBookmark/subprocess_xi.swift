import Foundation

func runSubprocessAccess(targetPath: String) {
    print("ğŸš¨ Parent: launching subprocess to test Î mint...")

    let task = Process()
    task.launchPath = "/usr/bin/swift"

    let swiftScript = """
    import Foundation
    let url = URL(fileURLWithPath: "\(targetPath)")
    if FileManager.default.fileExists(atPath: url.path) {
        do {
            let data = try Data(contentsOf: url)
            print("âœ… Subprocess Î minted: read \\(data.count) bytes")
        } catch {
            print("âŒ Subprocess Î failed: \\(error.localizedDescription)")
        }
    } else {
        print("âŒ Subprocess: file not found")
    }
    """

    task.arguments = ["-e", swiftScript]

    let pipe = Pipe()
    task.standardOutput = pipe
    task.standardError = pipe

    do {
        try task.run()
        task.waitUntilExit()

        let output = pipe.fileHandleForReading.readDataToEndOfFile()
        if let result = String(data: output, encoding: .utf8) {
            print("ğŸ“¡ Subprocess Output:\n\(result)")
        }
    } catch {
        print("âŒ Failed to run subprocess: \(error)")
    }
}

// Entry
let args = CommandLine.arguments
guard args.count == 2 else {
    print("Usage: ./subprocess_xi <path-to-file>")
    exit(1)
}

runSubprocessAccess(targetPath: args[1])
