//
//  main.swift  –  XiSandboxApp komut yönlendirici
//
import Foundation

@inline(__always)
func usageAndExit() -> Never {
    print("""
    usage:
      XiSandboxApp write      <file_path>
      XiSandboxApp read       <file_path>
      XiSandboxApp subprocess <file_path>
      XiSandboxApp pulse      <file_path> [sec]
      XiSandboxApp scan       <file_path>
    """)
    exit(1)
}

let argv = CommandLine.arguments
guard argv.count >= 3 else { usageAndExit() }

let cmd  = argv[1]
let path = argv[2]

switch cmd {

case "write":
    WriteExploit.run(path: path)

case "read":
    ReadExploit.run(path: path)

case "subprocess":
    runSubprocessAccess(targetPath: path)

case "pulse":
    let iv = argv.count >= 4 ? UInt32(argv[3]) ?? 3 : 3
    XiPulseMonitor.run(path: path, interval: iv)

case "scan":
    PsiScanner.run(path: path)

default:
    usageAndExit()
}
